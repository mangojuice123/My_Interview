- [常规状态转换](#常规状态转换)
- [常见问题](#常见问题)
  - [TCP 为什么不是两次握手建立连接？](#tcp-为什么不是两次握手建立连接)
  - [TCP 为什么不是四次握手建立连接？](#tcp-为什么不是四次握手建立连接)
  - [TCP 为什么需要四次挥手关闭连接？](#tcp-为什么需要四次挥手关闭连接)

</br></br>

# 常规状态转换
![状态转换](https://pic2.zhimg.com/80/ab46c8eb523f3f7686bc72fa23c82cc7_720w.jpg?source=1940ef5c)

# 常见问题
## TCP 为什么不是两次握手建立连接？
答：
- 这个问题的本质是，信道不可靠，但是通信双发需要就某个问题（ISN）达成一致。而要解决这个问题，无论你在消息中包含什么信息，三次通信是理论上的最小值。
- 假设有 A、B 两个结点，只使用两次握手的情况下，A 可以确认 B 的接收、发送能力正常，B 可以确认 A 的发送能力正常，但是 B 无法确认 A 的接收能力是否正常。
- 在实际的 TCP 实现中，TCP 连接握手确认的最重要的信息是，通信双方数据原点的序列号，即 `ISN = Initial Sequence Number`。
- 两次握手通信过程模拟
    1. `A ---> SYN + A's ISN ----> B`
    2. `B ---> SYN + B's ISN + B's ACK ----> A`
    3. 此时如果 B 发给 A 的信息丢失，那么 A 和 B 就 B 的初始序列号无法达成一致，不应该在此时传输数据，连接建立失败。但是在 B 的视角中，连接已经单方面建立起来，会造成资源浪费。

## TCP 为什么不是四次握手建立连接？
答：
1. `A ---> SYN + A's ISN ----> B`
2. `B ---> B's ACK ----> A`
3. `B ---> SYN + B's ISN ----> A`
4. `A ---> A's ACK ----> B`
- 显然 3 4 这两个步骤可以合并，类似的还有四挥手，`FIN + ACK` 合并提升效率。

## TCP 为什么需要四次挥手关闭连接？
- 由于 TCP 的半关闭（half-close）特性，TCP 提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。
- 任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了 TCP 连接。
- 即两次握手就可以释放一端到另一端的 TCP 连接，完全释放连接一共需要四次握手。